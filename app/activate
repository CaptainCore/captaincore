#!/usr/bin/env bash

#
#   Removes custom deactivate mu-plugin to batch of sites
#
#   `captaincore activate [<site>...]`
#

# Load configuration
root_path="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"; root_path=${root_path%app*}
source ${root_path}config

run_command() {

  for website in "$@"; do

    # Load site configs
    eval $(captaincore site get $website --bash --captain_id=$captain_id)

    if [ -z "$domain" ]; then
      echo "Domain not found"
      continue
    fi

    if [[ "$home_directory" != "" ]]; then
      home_directory="${home_directory}/"
    fi

    # Remove deactivation plugin
    rclone delete sftp-$site:${home_directory}wp-content/mu-plugins/captaincore_deactivated.php
    echo "activated $domain"

  done

}

# See if any specific sites are selected
if [ $# -gt 0 ]; then
  # Run selected site(s)
  run_command $*
fi
