#!/usr/bin/env bash

#
#   Removes a site from CaptainCore CLI.
#
#   `captaincore site delete <site>`
#

if [ ${#@} -ne 1 ]; then
  echo -e "${COLOR_RED}Error:${COLOR_NORMAL} Please specify a site."
  exit
fi

run_command() {

	site=$1

	cd ${root_path}data

	# Requires <site>
	if [[ "$site" == "" ]]; then
		echo -e "${COLOR_RED}Error:${COLOR_NORMAL} Please specify one a site."
		return 1
	fi

	verify=$( captaincore site get $site --captain-id=$captain_id )

	if [[ "$verify" == "" ]]; then
		echo -e "${COLOR_RED}Error:${COLOR_NORMAL} Site '$site' not found in CaptainCore."
		return 1
	fi

	# Final snapshot then remove site related files
	captaincore snapshot $site --delete-after-snapshot --email=$captaincore_admin_email --captain-id=$captain_id

	# Load site configs
	while read site_configs; do if [[ $site_configs == "" ]]; then continue; fi; declare "$site_configs"; done <<< "$(captaincore site get $site --bash --captain-id=$captain_id)"

	if [[ "$site" != "" ]] && [[ "$site_id" != "" ]]; then
		wp eval-file ../lib/local-scripts/site-delete.php site_id=$site_id captain-id=$captain_id
	fi

	# Update configs
	captaincore configs update-websites --captain-id=$captain_id

}

run_command $1